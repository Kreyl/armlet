<!DOCTYPE HTML>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="Author" content="Vasily Zakharov <vmzakhar@gmail.com>">
<title>Armlet GUI Test</title>
<style type="Text/CSS">
html, body {
  margin: 0;
  padding: 0;
}

pre {
  margin: 0;
  padding: 1px 2px;
}

#gui {
  width: 160px;
  height: 128px;
  position: relative;
  border: 1px solid black;
  margin: 1em;
  padding: 0;
}

.screen {
  width: 100%;
  height: 100%;
  font-family: Courier New, monospace;
  font-weight: bold;
  font-size: 14px;
  color: white;
  margin: 0;
  padding: 0;
  display: none;
}

.button {
  position: absolute;
}

#lock {
  position: absolute;
  display: none;
}
</style>
<script type="Text/JavaScript">
var IMAGES = '../SD/GUI/';

var A = 'A';
var B = 'B';
var C = 'C';
var L = 'L';
var E = 'E';
var R = 'R';
var X = 'X';
var Y = 'Y';
var Z = 'Z';

var ABSENT = 0;
var NORMAL = 1;
var PRESSED = 2;
var NOT = 3;
var ENABLED = 4;
var DISABLED = 5;

var STATES = ['absent', 'normal', 'pressed', 'not', 'enabled', 'disabled'];

var TITLE = 'CharName   23:59 BB';

var currentScreen = null;

var locked = false;

function setState(button, state) {
    button.state = state;
    button.src = button.states[state];
}

function mouseDown() {
    var newState = null;
    switch (this.letter) {
    case B:
    case C:
    case E:
    case X:
    case Y:
    case Z:
        if (locked) {
            break;
        }
    case L:
        newState = PRESSED;
        break;
    }
    if (newState != null) {
        setState(this, newState);
    }
}

function mouseUp() {
    if (this.state == NOT) {
        setState(this, NORMAL);
    }
    if (this.state != PRESSED) {
        return;
    }
    var newScreen = currentScreen;
    switch (this.letter) {
    case L:
        newScreen = 0;
        locked = !locked;
        break;
    case E:
        newScreen = (currentScreen + 1) % screens.length;
        break;
    case B:
    case C:
    case X:
    case Y:
    case Z:
        if (currentScreen != 0) {
            this.enabled = !this.enabled;
            setState(this, this.enabled ? ENABLED : NORMAL);
        }
        break;
    }
    var buttons = screens[newScreen].buttons;
    for (var i = 0, button; button = buttons[i++];) {
        if (button.state == PRESSED || button.state == NOT) {
            setState(button, NORMAL);
        }
    }
    if (newScreen != currentScreen) {
        screens[currentScreen].style.display = 'none';
        currentScreen = newScreen;
        screens[currentScreen].style.display = 'block';
    }
    lock.style.display = locked ? 'block' : 'none';
}

function mouseOut() {
    if (this.state == PRESSED || this.state == NOT) {
        setState(this, NORMAL);
    }
}

function main() {
    screens = document.getElementsByClassName('screen');
    for (var i = 0, screen; screen = screens[i++];) {
        var pre = document.createElement('pre');
        pre.appendChild(document.createTextNode(TITLE));
        screen.insertBefore(pre, screen.firstChild);
        screen.style.background = 'url(' + IMAGES + screen.id + '/back.bmp)';
        if (i == 1) {
            screen.style.display = 'block';
            currentScreen = i - 1;
        }
        screen.buttons = screen.getElementsByClassName('button');
        for (var j = 0, button; button = screen.buttons[j++];) {
            button.letter = button.alt;
            button.enabled = false;
            var prefix = IMAGES + screen.id + '/';
            var suffix = '/' + button.letter + '.bmp';
            button.states = [];
            for (var k = 0; k < STATES.length; k++) {
              button.states[k] = prefix + STATES[k] + suffix;
            }
            button.onmousedown = mouseDown;
            button.onmouseup = mouseUp;
            button.onmouseout = mouseOut;
            setState(button, NORMAL);
        }
    }
    lock = document.getElementById('lock');
    lock.src = IMAGES + 'lock.bmp';
}
</script>
</head>
<body onload="main()">
  <div id="gui">
    <div id="main" class="screen">
      <img class="button" alt="L" style="top: 114px">
      <img class="button" alt="E" style="top: 114px; left: 28px">
      <img class="button" alt="X" style="top: 20px; left: 98px">
      <img class="button" alt="Y" style="top: 58px; left: 98px">
      <img class="button" alt="Z" style="top: 96px; left: 98px">
    </div>
    <div id="intentions" class="screen">
      <img class="button" alt="B" style="top: 38px">
      <img class="button" alt="C" style="top: 76px">
      <img class="button" alt="L" style="top: 114px">
      <img class="button" alt="E" style="top: 114px; left: 28px">
      <img class="button" alt="X" style="top: 20px; left: 98px">
      <img class="button" alt="Y" style="top: 58px; left: 98px">
      <img class="button" alt="Z" style="top: 96px; left: 98px">
    </div>
    <img id="lock" style="top: 45px; left: 63px">
  </div>
</body>
</html>
